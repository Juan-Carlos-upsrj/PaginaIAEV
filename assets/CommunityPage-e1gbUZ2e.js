import{u as y,j as e}from"./index-D6mZ5jKc.js";import{u as N,b as l}from"./react-vendor-DzKpeQDD.js";const k=({courseId:t,courseName:b})=>{N();const{user:a}=y(),[o,c]=l.useState([]),[r,h]=l.useState(""),[d,g]=l.useState("all"),m="/iaev/iaev/api",x=async()=>{if(a)try{const s=new URL(`${m}/community.php`,window.location.origin);s.searchParams.append("action","get_posts"),s.searchParams.append("user_id",a.id.toString()),t&&s.searchParams.append("course_id",t.toString());const i=await(await fetch(s.toString())).json();i.success&&c(i.posts)}catch(s){console.error("Failed to fetch posts",s)}};l.useEffect(()=>{x();const s=setInterval(x,3e4);return()=>clearInterval(s)},[a,t]);const p=o.filter(s=>t?s.courseId===t:d==="course"?s.courseId!==null:!0),f=async s=>{if(!a)return;const u=[...o],i=o.map(n=>n.id===s?{...n,likes:n.isLiked?n.likes-1:n.likes+1,isLiked:!n.isLiked}:n);c(i);try{await fetch(`${m}/community.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"like_post",user_id:a.id,post_id:s})})}catch(n){console.error("Failed to like post",n),c(u)}},j=async()=>{if(!(!r.trim()||!a))try{(await(await fetch(`${m}/community.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create_post",user_id:a.id,content:r,course_id:t||null})})).json()).success&&(h(""),x())}catch(s){console.error("Failed to create post",s)}};return a?e.jsxs("div",{className:"min-h-screen bg-transparent pb-20",children:[!t&&e.jsx("header",{className:"sticky top-4 z-50 mx-4 mb-8 rounded-2xl glass shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:"/dashboard",className:"p-2 rounded-xl hover:bg-blue-50 text-blue-600 transition-colors",children:e.jsx("ion-icon",{name:"arrow-back-outline",class:"w-6 h-6"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Comunidad"})]}),e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-xl",children:[e.jsx("button",{onClick:()=>g("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${d==="all"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"General"}),e.jsx("button",{onClick:()=>g("course"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${d==="course"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Mis Cursos"})]})]})})}),e.jsxs("main",{className:`${t?"":"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8"}`,children:[e.jsx("div",{className:"glass p-6 rounded-2xl mb-8",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:`https://ui-avatars.com/api/?name=${a.name}&background=random`,alt:a.name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:r,onChange:s=>h(s.target.value),placeholder:t?`Pregunta algo sobre ${b}...`:"¿Qué estás aprendiendo hoy?",className:"w-full bg-gray-50 border-0 rounded-xl p-4 focus:ring-2 focus:ring-blue-500 transition-all resize-none",rows:3}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"flex gap-2 text-gray-400",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx("ion-icon",{name:"image-outline",class:"w-5 h-5"})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx("ion-icon",{name:"link-outline",class:"w-5 h-5"})})]}),e.jsx("button",{onClick:j,disabled:!r.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-600/20",children:"Publicar"})]})]})]})}),e.jsx("div",{className:"space-y-6",children:p.length>0?p.map(s=>e.jsxs("div",{className:"glass p-6 rounded-2xl",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.avatar,alt:s.author,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:s.author}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:s.timeAgo}),s.courseName&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{className:"text-blue-600 font-medium bg-blue-50 px-2 py-0.5 rounded-full",children:s.courseName})]})]})]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx("ion-icon",{name:"ellipsis-horizontal"})})]}),e.jsx("p",{className:"text-gray-800 mb-4 whitespace-pre-wrap",children:s.content}),e.jsxs("div",{className:"flex items-center gap-6 border-t border-gray-100 pt-4",children:[e.jsxs("button",{onClick:()=>f(s.id),className:`flex items-center gap-2 text-sm font-medium transition-colors ${s.isLiked?"text-red-500":"text-gray-500 hover:text-red-500"}`,children:[e.jsx("ion-icon",{name:s.isLiked?"heart":"heart-outline",class:"w-5 h-5"}),s.likes]}),e.jsxs("button",{className:"flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-blue-600 transition-colors",children:[e.jsx("ion-icon",{name:"chatbubble-outline",class:"w-5 h-5"}),s.comments]}),e.jsxs("button",{className:"flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-green-600 transition-colors ml-auto",children:[e.jsx("ion-icon",{name:"share-social-outline",class:"w-5 h-5"}),"Compartir"]})]})]},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400",children:e.jsx("ion-icon",{name:"chatbubbles-outline",class:"text-3xl"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Aún no hay publicaciones"}),e.jsx("p",{className:"text-gray-500",children:"¡Sé el primero en compartir algo!"})]})})]})]}):null};export{k as default};
